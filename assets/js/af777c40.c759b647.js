/*! For license information please see af777c40.c759b647.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[997511],{475439:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>f,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var r=n(824246),o=n(511151);const i={id:"switching-sqlite-postgres",title:"Switching Backstage from SQLite to PostgreSQL",description:"How to get ready for deploying Backstage to production with PostgreSQL"},a=void 0,s={unversionedId:"tutorials/switching-sqlite-postgres",id:"tutorials/switching-sqlite-postgres",title:"Switching Backstage from SQLite to PostgreSQL",description:"How to get ready for deploying Backstage to production with PostgreSQL",source:"@site/../docs/tutorials/switching-sqlite-postgres.md",sourceDirName:"tutorials",slug:"/tutorials/switching-sqlite-postgres",permalink:"/docs/tutorials/switching-sqlite-postgres",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/tutorials/switching-sqlite-postgres.md",tags:[],version:"current",frontMatter:{id:"switching-sqlite-postgres",title:"Switching Backstage from SQLite to PostgreSQL",description:"How to get ready for deploying Backstage to production with PostgreSQL"},sidebar:"docs",previous:{title:"Configuring Plugin Databases",permalink:"/docs/tutorials/configuring-plugin-databases"},next:{title:"Using the Backstage Proxy from Within a Plugin",permalink:"/docs/tutorials/using-backstage-proxy-within-plugin"}},c={},l=[{value:"Install PostgreSQL",id:"install-postgresql",level:2},{value:"Add PostgreSQL configuration",id:"add-postgresql-configuration",level:2},{value:"Override default PostgreSQL Database Pool Configuration",id:"override-default-postgresql-database-pool-configuration",level:3},{value:"Using a single database",id:"using-a-single-database",level:3}];function u(e){const t=Object.assign({p:"p",code:"code",a:"a",h2:"h2",pre:"pre",h3:"h3"},(0,o.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["The default ",(0,r.jsx)(t.code,{children:"@backstage/create-app"})," database is SQLite, an in-memory database\nthat's perfect for initial experimentation as it requires no environment setup."]}),"\n",(0,r.jsx)(t.p,{children:"Once you're ready to deploy Backstage in production, or to have a more\npersistent development setup, you can switch the Backstage database to\nPostgreSQL."}),"\n",(0,r.jsxs)(t.p,{children:["Backstage uses the ",(0,r.jsx)(t.a,{href:"https://knexjs.org/",children:"Knex"})," library, making it fairly easy to\nswitch between database backends."]}),"\n",(0,r.jsx)(t.h2,{id:"install-postgresql",children:"Install PostgreSQL"}),"\n",(0,r.jsxs)(t.p,{children:["First, add PostgreSQL to your ",(0,r.jsx)(t.code,{children:"backend"})," package:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# From your Backstage root directory\nyarn add --cwd packages/backend pg\n"})}),"\n",(0,r.jsx)(t.h2,{id:"add-postgresql-configuration",children:"Add PostgreSQL configuration"}),"\n",(0,r.jsxs)(t.p,{children:["Next, modify ",(0,r.jsx)(t.code,{children:"app-config.yaml"})," in the root folder to add PostgreSQL\nconfiguration for the backend:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'title="app-config.yaml"',children:"backend:\n  database:\n    # highlight-remove-start\n    client: better-sqlite3\n    connection: ':memory:'\n    # highlight-remove-end\n    # highlight-add-start\n    # config options: https://node-postgres.com/apis/client\n    client: pg\n    connection:\n      host: ${POSTGRES_HOST}\n      port: ${POSTGRES_PORT}\n      user: ${POSTGRES_USER}\n      password: ${POSTGRES_PASSWORD}\n      # https://node-postgres.com/features/ssl\n      # you can set the sslmode configuration option via the `PGSSLMODE` environment variable\n      # see https://www.postgresql.org/docs/current/libpq-ssl.html Table 33.1. SSL Mode Descriptions (e.g. require)\n      # ssl:\n      #   ca: # if you have a CA file and want to verify it you can uncomment this section\n      #     $file: <file-path>/ca/server.crt\n    # highlight-add-end\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If you have an ",(0,r.jsx)(t.code,{children:"app-config.local.yaml"})," for local development, a similar update\nshould be made there. You can set the ",(0,r.jsx)(t.code,{children:"POSTGRES_"})," environment variables prior to\nlaunching Backstage, or remove the ",(0,r.jsx)(t.code,{children:"${...}"})," values and simply set actual values\ndirectly for development."]}),"\n",(0,r.jsx)(t.p,{children:"The Backstage App is now ready to start up with a PostgreSQL backing database."}),"\n",(0,r.jsx)(t.h3,{id:"override-default-postgresql-database-pool-configuration",children:"Override default PostgreSQL Database Pool Configuration"}),"\n",(0,r.jsx)(t.p,{children:"If you want to override the default connection pool settings then use the below configuration:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'title="app-config.local.yaml"',children:"backend:\n  database:\n    # highlight-remove-start\n    client: better-sqlite3\n    connection: ':memory:'\n    # highlight-remove-end\n    # highlight-add-start\n    # config options: https://node-postgres.com/apis/client\n    client: pg\n    connection:\n      host: ${POSTGRES_HOST}\n      port: ${POSTGRES_PORT}\n      user: ${POSTGRES_USER}\n      password: ${POSTGRES_PASSWORD}\n      # https://node-postgres.com/features/ssl\n      # you can set the sslmode configuration option via the `PGSSLMODE` environment variable\n      # see https://www.postgresql.org/docs/current/libpq-ssl.html Table 33.1. SSL Mode Descriptions (e.g. require)\n      # ssl:\n      #   ca: # if you have a CA file and want to verify it you can uncomment this section\n      #     $file: <file-path>/ca/server.crt\n    # Refer to Tarn docs for default values on PostgreSQL pool configuration - https://github.com/Vincit/tarn.js\n    knexConfig:\n      pool:\n        min: 3\n        max: 12\n        acquireTimeoutMillis: 60000\n        idleTimeoutMillis: 60000\n      # highlight-add-end\n"})}),"\n",(0,r.jsx)(t.h3,{id:"using-a-single-database",children:"Using a single database"}),"\n",(0,r.jsxs)(t.p,{children:["By default, each plugin will get its own logical database, to ensure that there's no conflict in table names throughout the plugins that you install and to keep their concerns separate for other use cases further down the line. If you are limited in that you can only make use of a single database, you can use a special option ",(0,r.jsx)(t.code,{children:"pluginDivisionMode"})," with ",(0,r.jsx)(t.code,{children:"client: pg"})," in the config to create separate ",(0,r.jsx)(t.a,{href:"https://www.postgresql.org/docs/current/ddl-schemas.html",children:"PostgreSQL Schemas"})," instead of creating separate databases."]}),"\n",(0,r.jsx)(t.p,{children:"You can enable this using the following config:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"backend:\n  database:\n    client: pg\n    pluginDivisionMode: schema # defaults to database, but changing this to schema means plugins will be given their own schema (in the specified/default database)\n"})})]})}const f=function(e={}){const{wrapper:t}=Object.assign({},(0,o.ah)(),e.components);return t?(0,r.jsx)(t,Object.assign({},e,{children:(0,r.jsx)(u,e)})):u(e)}},862525:e=>{var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(o){return!1}}()?Object.assign:function(e,o){for(var i,a,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),c=1;c<arguments.length;c++){for(var l in i=Object(arguments[c]))n.call(i,l)&&(s[l]=i[l]);if(t){a=t(i);for(var u=0;u<a.length;u++)r.call(i,a[u])&&(s[a[u]]=i[a[u]])}}return s}},371426:(e,t,n)=>{n(862525);var r=n(827378),o=60103;if(t.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var i=Symbol.for;o=i("react.element"),t.Fragment=i("react.fragment")}var a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,i={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!c.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:o,type:e,key:l,ref:u,props:i,_owner:a.current}}t.jsx=l,t.jsxs=l},541535:(e,t,n)=>{var r=n(862525),o=60103,i=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var a=60109,s=60110,c=60112;t.Suspense=60113;var l=60115,u=60116;if("function"==typeof Symbol&&Symbol.for){var f=Symbol.for;o=f("react.element"),i=f("react.portal"),t.Fragment=f("react.fragment"),t.StrictMode=f("react.strict_mode"),t.Profiler=f("react.profiler"),a=f("react.provider"),s=f("react.context"),c=f("react.forward_ref"),t.Suspense=f("react.suspense"),l=f("react.memo"),u=f("react.lazy")}var d="function"==typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||h}function m(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||h}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},m.prototype=y.prototype;var b=v.prototype=new m;b.constructor=v,r(b,y.prototype),b.isPureReactComponent=!0;var S={current:null},w=Object.prototype.hasOwnProperty,j={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,n){var r,i={},a=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)w.call(t,r)&&!j.hasOwnProperty(r)&&(i[r]=t[r]);var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===i[r]&&(i[r]=c[r]);return{$$typeof:o,type:e,key:a,ref:s,props:i,_owner:S.current}}function k(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}var P=/\/+/g;function x(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,n,r,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case o:case i:c=!0}}if(c)return a=a(c=e),e=""===r?"."+x(c,0):r,Array.isArray(a)?(n="",null!=e&&(n=e.replace(P,"$&/")+"/"),O(a,t,n,"",(function(e){return e}))):null!=a&&(k(a)&&(a=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,n+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(P,"$&/")+"/")+e)),t.push(a)),1;if(c=0,r=""===r?".":r+":",Array.isArray(e))for(var l=0;l<e.length;l++){var u=r+x(s=e[l],l);c+=O(s,t,n,u,a)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(s=e.next()).done;)c+=O(s=s.value,t,n,u=r+x(s,l++),a);else if("object"===s)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return c}function E(e,t,n){if(null==e)return e;var r=[],o=0;return O(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function R(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var $={current:null};function C(){var e=$.current;if(null===e)throw Error(p(321));return e}var L={ReactCurrentDispatcher:$,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:S,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:E,forEach:function(e,t,n){E(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return E(e,(function(){t++})),t},toArray:function(e){return E(e,(function(e){return e}))||[]},only:function(e){if(!k(e))throw Error(p(143));return e}},t.Component=y,t.PureComponent=v,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.cloneElement=function(e,t,n){if(null==e)throw Error(p(267,e));var i=r({},e.props),a=e.key,s=e.ref,c=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,c=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(u in t)w.call(t,u)&&!j.hasOwnProperty(u)&&(i[u]=void 0===t[u]&&void 0!==l?l[u]:t[u])}var u=arguments.length-2;if(1===u)i.children=n;else if(1<u){l=Array(u);for(var f=0;f<u;f++)l[f]=arguments[f+2];i.children=l}return{$$typeof:o,type:e.type,key:a,ref:s,props:i,_owner:c}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=_,t.createFactory=function(e){var t=_.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=k,t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return C().useCallback(e,t)},t.useContext=function(e,t){return C().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return C().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return C().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return C().useLayoutEffect(e,t)},t.useMemo=function(e,t){return C().useMemo(e,t)},t.useReducer=function(e,t,n){return C().useReducer(e,t,n)},t.useRef=function(e){return C().useRef(e)},t.useState=function(e){return C().useState(e)},t.version="17.0.2"},827378:(e,t,n)=>{e.exports=n(541535)},824246:(e,t,n)=>{e.exports=n(371426)},511151:(e,t,n)=>{n.d(t,{Zo:()=>s,ah:()=>i});var r=n(667294);const o=r.createContext({});function i(e){const t=r.useContext(o);return r.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const a={};function s({components:e,children:t,disableParentContext:n}){let s;return s=n?"function"==typeof e?e({}):e||a:i(e),r.createElement(o.Provider,{value:s},t)}}}]);