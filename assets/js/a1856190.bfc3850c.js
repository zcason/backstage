/*! For license information please see a1856190.bfc3850c.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[441630],{719758:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>u});var n=r(824246),o=r(511151);const s={id:"authentication",title:"Kubernetes Authentication",description:"Authentication in Kubernetes plugin"},i=void 0,a={unversionedId:"features/kubernetes/authentication",id:"features/kubernetes/authentication",title:"Kubernetes Authentication",description:"Authentication in Kubernetes plugin",source:"@site/../docs/features/kubernetes/authentication.md",sourceDirName:"features/kubernetes",slug:"/features/kubernetes/authentication",permalink:"/docs/features/kubernetes/authentication",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/features/kubernetes/authentication.md",tags:[],version:"current",frontMatter:{id:"authentication",title:"Kubernetes Authentication",description:"Authentication in Kubernetes plugin"},sidebar:"docs",previous:{title:"Configuration",permalink:"/docs/features/kubernetes/configuration"},next:{title:"Troubleshooting",permalink:"/docs/features/kubernetes/troubleshooting"}},c={},u=[{value:"Server Side Providers",id:"server-side-providers",level:2},{value:"AWS",id:"aws",level:3},{value:"Azure",id:"azure",level:3},{value:"Client Side Providers",id:"client-side-providers",level:2}];function l(e){const t=Object.assign({p:"p",code:"code",h2:"h2",em:"em",ul:"ul",li:"li",h3:"h3",a:"a",pre:"pre"},(0,o.ah)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:["The authentication process in Kubernetes relies on ",(0,n.jsx)(t.code,{children:"KubernetesAuthProviders"}),", which are\nnot the same as the application's auth providers, the default providers are defined in\n",(0,n.jsx)(t.code,{children:"plugins/kubernetes/src/kubernetes-auth-provider/KubernetesAuthProviders.ts"}),", you can\nadd custom providers there if needed."]}),"\n",(0,n.jsx)(t.p,{children:"These providers are configured so your Kubernetes plugin can locate and access the\nclusters you have access to, some of them have special requirements in the third party in\nquestion, like Azure's Managed AAD subscription or Azure RBAC support active on the cluster."}),"\n",(0,n.jsx)(t.p,{children:"The providers currently available are divided into server side and client side."}),"\n",(0,n.jsx)(t.h2,{id:"server-side-providers",children:"Server Side Providers"}),"\n",(0,n.jsxs)(t.p,{children:["These providers authenticate your ",(0,n.jsx)(t.em,{children:"application"})," with the cluster, meaning anyone that is\nlogged in into your backstage app will be granted the same access to Kubernetes objects, including guest users."]}),"\n",(0,n.jsx)(t.p,{children:"The providers available as server side are:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"aws"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"azure"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"googleServiceAccount"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"localKubectlProxy"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"serviceAccount"})}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"aws",children:"AWS"}),"\n",(0,n.jsxs)(t.p,{children:['For AWS, in addition to the "kubernetes" configuration, you will have to set up AWS authentication. The AWS server-side authentication provider uses ',(0,n.jsx)(t.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/when-to-use-iam.html",children:"AWS Identity and Access Management (IAM)"})," to authenticate to the target Account(s), you can read more about it on the page for the ",(0,n.jsx)(t.a,{href:"https://github.com/backstage/backstage/blob/master/packages/integration-aws-node/README.md",children:"Integration AWS node"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["Using the plugin, you can authenticate to several AWS accounts using either ",(0,n.jsx)(t.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html",children:"static AWS Access keys"})," or short-lived Access keys generated by ",(0,n.jsx)(t.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use.html",children:"assuming a role"}),", for either case you will need to install the ",(0,n.jsx)(t.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"AWS CLI utility"})," and set it up following the steps in the linked documentation."]}),"\n",(0,n.jsx)(t.p,{children:"If you have generated static AWS security credentials, the configuration block for AWS will look like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"aws:\n  mainAccount:\n  accounts:\n    - accountId: '<account-number>'\n      accessKeyId: ${AWS_ACCESS_KEY_ID}\n      secretAccessKey: ${AWS_SECRET_ACCESS_KEY}\n      region: <region>\n  accountDefaults:\n"})}),"\n",(0,n.jsx)(t.p,{children:"If your environment is set up to assume a role, the configuration would instead look like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"aws:\n  mainAccount:\n    roleName: <name-of-the-role-to-assume>\n    region: <region>\n  accounts:\n  accountDefaults:\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Either of these sections needs to be present for the Kubernetes configuration to use the ",(0,n.jsx)(t.code,{children:"aws"})," ",(0,n.jsx)(t.code,{children:"authProvider"}),". The Kubernetes configuration looks like this:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"kubernetes:\n  serviceLocatorMethod:\n    type: 'multiTenant'\n  clusterLocatorMethods:\n    - type: 'config'\n      clusters:\n        - url: https://<unique-identifier>.<region>.eks.amazonaws.com\n          name: <cluster-name-to-use>\n          authProvider: 'aws'\n          caData: ${EKS_CA_DATA}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["You get both, the cluster ",(0,n.jsx)(t.code,{children:"url"})," and ",(0,n.jsx)(t.code,{children:"caData"})," directly from the AWS console by going to ",(0,n.jsx)(t.code,{children:"EKS"})," > ",(0,n.jsx)(t.code,{children:"Your cluster"})," > ",(0,n.jsx)(t.code,{children:"Overview"})," > ",(0,n.jsx)(t.code,{children:"Details"}),". You will find them under 'API server endpoint' and 'Certificate authority' respectively."]}),"\n",(0,n.jsx)(t.h3,{id:"azure",children:"Azure"}),"\n",(0,n.jsxs)(t.p,{children:["The Azure server side authentication provider works by authenticating on the server with\nthe Azure CLI, please note that ",(0,n.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/aks/managed-aad",children:"Azure AD Authentication"})," is a requirement and has to\nbe enabled in your AKS cluster, then follow these steps:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest",children:"Install the Azure CLI"})," in the environment where the backstage application will run."]}),"\n",(0,n.jsxs)(t.li,{children:["Login with your Azure/Microsoft account with ",(0,n.jsx)(t.code,{children:"az login"})," in the server's terminal."]}),"\n",(0,n.jsxs)(t.li,{children:["Go to your AKS cluster's resource page in Azure Console and follow the steps in the\n",(0,n.jsx)(t.code,{children:"Connect"})," tab to set the subscription and get your credentials for ",(0,n.jsx)(t.code,{children:"kubectl"})," integration."]}),"\n",(0,n.jsxs)(t.li,{children:["Configure your cluster to use the ",(0,n.jsx)(t.code,{children:"azure"})," auth provider like this:"]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"kubernetes:\n  clusterLocatorMethods:\n    - type: 'config'\n      clusters:\n        - name: My AKS cluster\n          url: ${AZURE_CLUSTER_API_SERVER_ADDRESS}\n          authProvider: azure\n          skipTLSVerify: true\n"})}),"\n",(0,n.jsxs)(t.p,{children:["To get the API server address for your Azure cluster, go to the Azure console page for the\ncluster resource, go to ",(0,n.jsx)(t.code,{children:"Overview"})," > ",(0,n.jsx)(t.code,{children:"Properties"})," tab > ",(0,n.jsx)(t.code,{children:"Networking"})," section and copy paste\nthe API server address directly in that ",(0,n.jsx)(t.code,{children:"url"})," field."]}),"\n",(0,n.jsx)(t.h2,{id:"client-side-providers",children:"Client Side Providers"}),"\n",(0,n.jsxs)(t.p,{children:["These providers authenticate your ",(0,n.jsx)(t.em,{children:"user"})," with the cluster. Each Backstage user will be\nprompted for credentials and will have access to the clusters as long as the user has been\nauthorized to access said cluster. If the cluster is listed in the ",(0,n.jsx)(t.code,{children:"clusterLocatorMethods"}),",\nbut the user hasn't been authorized to access, the user will see the cluster listed but\nwill not see any resources in the plugin page for that cluster, and the error will show\nas ",(0,n.jsx)(t.code,{children:"401"})," or similar."]}),"\n",(0,n.jsx)(t.p,{children:"The providers available as client side are:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"aks"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"google"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"oidc"})}),"\n"]})]})}const d=function(e={}){const{wrapper:t}=Object.assign({},(0,o.ah)(),e.components);return t?(0,n.jsx)(t,Object.assign({},e,{children:(0,n.jsx)(l,e)})):l(e)}},862525:e=>{var t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(o){return!1}}()?Object.assign:function(e,o){for(var s,i,a=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),c=1;c<arguments.length;c++){for(var u in s=Object(arguments[c]))r.call(s,u)&&(a[u]=s[u]);if(t){i=t(s);for(var l=0;l<i.length;l++)n.call(s,i[l])&&(a[i[l]]=s[i[l]])}}return a}},371426:(e,t,r)=>{r(862525);var n=r(827378),o=60103;if(t.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var s=Symbol.for;o=s("react.element"),t.Fragment=s("react.fragment")}var i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a=Object.prototype.hasOwnProperty,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var n,s={},u=null,l=null;for(n in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)a.call(t,n)&&!c.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===s[n]&&(s[n]=t[n]);return{$$typeof:o,type:e,key:u,ref:l,props:s,_owner:i.current}}t.jsx=u,t.jsxs=u},541535:(e,t,r)=>{var n=r(862525),o=60103,s=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var i=60109,a=60110,c=60112;t.Suspense=60113;var u=60115,l=60116;if("function"==typeof Symbol&&Symbol.for){var d=Symbol.for;o=d("react.element"),s=d("react.portal"),t.Fragment=d("react.fragment"),t.StrictMode=d("react.strict_mode"),t.Profiler=d("react.profiler"),i=d("react.provider"),a=d("react.context"),c=d("react.forward_ref"),t.Suspense=d("react.suspense"),u=d("react.memo"),l=d("react.lazy")}var h="function"==typeof Symbol&&Symbol.iterator;function f(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y={};function v(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||p}function m(){}function g(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(f(85));this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},m.prototype=v.prototype;var b=g.prototype=new m;b.constructor=g,n(b,v.prototype),b.isPureReactComponent=!0;var j={current:null},x=Object.prototype.hasOwnProperty,w={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,r){var n,s={},i=null,a=null;if(null!=t)for(n in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(i=""+t.key),t)x.call(t,n)&&!w.hasOwnProperty(n)&&(s[n]=t[n]);var c=arguments.length-2;if(1===c)s.children=r;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];s.children=u}if(e&&e.defaultProps)for(n in c=e.defaultProps)void 0===s[n]&&(s[n]=c[n]);return{$$typeof:o,type:e,key:i,ref:a,props:s,_owner:j.current}}function k(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}var A=/\/+/g;function S(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,r,n,i){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case o:case s:c=!0}}if(c)return i=i(c=e),e=""===n?"."+S(c,0):n,Array.isArray(i)?(r="",null!=e&&(r=e.replace(A,"$&/")+"/"),C(i,t,r,"",(function(e){return e}))):null!=i&&(k(i)&&(i=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,r+(!i.key||c&&c.key===i.key?"":(""+i.key).replace(A,"$&/")+"/")+e)),t.push(i)),1;if(c=0,n=""===n?".":n+":",Array.isArray(e))for(var u=0;u<e.length;u++){var l=n+S(a=e[u],u);c+=C(a,t,r,l,i)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),u=0;!(a=e.next()).done;)c+=C(a=a.value,t,r,l=n+S(a,u++),i);else if("object"===a)throw t=""+e,Error(f(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return c}function E(e,t,r){if(null==e)return e;var n=[],o=0;return C(e,n,"","",(function(e){return t.call(r,e,o++)})),n}function O(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var P={current:null};function I(){var e=P.current;if(null===e)throw Error(f(321));return e}var R={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:j,IsSomeRendererActing:{current:!1},assign:n};t.Children={map:E,forEach:function(e,t,r){E(e,(function(){t.apply(this,arguments)}),r)},count:function(e){var t=0;return E(e,(function(){t++})),t},toArray:function(e){return E(e,(function(e){return e}))||[]},only:function(e){if(!k(e))throw Error(f(143));return e}},t.Component=v,t.PureComponent=g,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.cloneElement=function(e,t,r){if(null==e)throw Error(f(267,e));var s=n({},e.props),i=e.key,a=e.ref,c=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,c=j.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)x.call(t,l)&&!w.hasOwnProperty(l)&&(s[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)s.children=r;else if(1<l){u=Array(l);for(var d=0;d<l;d++)u[d]=arguments[d+2];s.children=u}return{$$typeof:o,type:e.type,key:i,ref:a,props:s,_owner:c}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:a,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:i,_context:e},e.Consumer=e},t.createElement=_,t.createFactory=function(e){var t=_.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=k,t.lazy=function(e){return{$$typeof:l,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return I().useCallback(e,t)},t.useContext=function(e,t){return I().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return I().useEffect(e,t)},t.useImperativeHandle=function(e,t,r){return I().useImperativeHandle(e,t,r)},t.useLayoutEffect=function(e,t){return I().useLayoutEffect(e,t)},t.useMemo=function(e,t){return I().useMemo(e,t)},t.useReducer=function(e,t,r){return I().useReducer(e,t,r)},t.useRef=function(e){return I().useRef(e)},t.useState=function(e){return I().useState(e)},t.version="17.0.2"},827378:(e,t,r)=>{e.exports=r(541535)},824246:(e,t,r)=>{e.exports=r(371426)},511151:(e,t,r)=>{r.d(t,{Zo:()=>a,ah:()=>s});var n=r(667294);const o=n.createContext({});function s(e){const t=n.useContext(o);return n.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const i={};function a({components:e,children:t,disableParentContext:r}){let a;return a=r?"function"==typeof e?e({}):e||i:s(e),n.createElement(o.Provider,{value:a},t)}}}]);